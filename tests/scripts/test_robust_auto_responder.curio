# Test Robust Auto-Responder Script
# This script tests the robust auto-responder with comprehensive error handling

print("=== Test Robust Auto-Responder Script ===")
print("This script tests the robust auto-responder with timeout and error handling")
print("The script should either succeed completely or fail with a clear error message")

# Test 1: Initial state
print("\n1. Initial state:")
print("   Project loaded:", is_project_loaded())
print("   Can create project:", can_create_project())

# Test 2: Test New Project dialog with robust auto-responder
print("\n2. Testing New Project dialog with robust auto-responder...")
print("   The dialog should appear and be automatically filled")
print("   If any unexpected condition occurs, an assertion error should be raised")
print("   The script should never hang - it will either succeed or fail fast")

try:
    trigger_menu("Project", "New Project")
    print("   ✅ New Project menu triggered successfully")
except Exception as e:
    print(f"   ❌ Error triggering New Project menu: {e}")
    exit(1)

print("\n3. After auto-responded project creation:")
print("   Project loaded:", is_project_loaded())
print("   Can create project:", can_create_project())
print("   Can save project:", can_save_project())
print("   Can close project:", can_close_project())

if is_project_loaded():
    print("   ✅ Project creation successful with robust auto-responder!")
    project_info := get_project_info()
    print("   Project name:", project_info.get("name", "Unknown"))
    print("   Project path:", project_info.get("path", "Unknown"))
else:
    print("   ❌ Project creation failed with robust auto-responder!")
    print("   This should not happen - the auto-responder should have either succeeded or failed with an error")
    exit(1)

# Test 4: Close project
print("\n4. Closing project...")
try:
    trigger_menu("Project", "Close Project")
    print("   ✅ Close Project menu triggered successfully")
except Exception as e:
    print(f"   ❌ Error triggering Close Project menu: {e}")
    exit(1)

print("\n5. After closing project:")
print("   Project loaded:", is_project_loaded())
print("   Can create project:", can_create_project())

if not is_project_loaded():
    print("   ✅ Project close successful!")
else:
    print("   ❌ Project close failed!")

print("\n=== Robust Auto-Responder Test Results ===")
print("Expected results:")
print("  ✅ New Project dialog auto-filled and completed successfully")
print("  ✅ No hanging or timeout issues")
print("  ✅ Clear error messages if anything goes wrong")
print("  ✅ Project creation and closing worked correctly")

print("\n✅ All tests passed! The robust auto-responder is working correctly!")
print("The system now fails fast instead of hanging on unexpected conditions.")

exit(0)

